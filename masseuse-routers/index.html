
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      
        masseuse routers - 
      
      Solid Recipes
    </title>
    <meta name="description" content="">
    <meta name="author" content="Solid Interactive">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/css-social-buttons/css/zocial.stripped.css">
    <link href="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>
    <div id="page-wrap">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>

            <a class="brand" href="http://solid-interactive.github.io/Recipes">Solid Recipes</a>

            <div class="nav-collapse">
              <ul class="nav">
                
                
                


  
    
      
      	
      	<li><a href="http://solid-interactive.github.io/Recipes/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://solid-interactive.github.io/Recipes/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://solid-interactive.github.io/Recipes/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://solid-interactive.github.io/Recipes/tags.html">Tags</a></li>
      	
      
    
  



              </ul>
              <ul class="nav pull-right social visible-desktop">
                <li class="divider-vertical"></li>
                
                <li>
                  <a href="https://github.com/Solid-Interactive" class="zocial github icon" target="_blank">
                    <span class="hidden-desktop">Github</span>
                  </a>
                </li>
                
                
                
                <li>
                  <a href="https://twitter.com/thinksolid" class="zocial twitter icon" target="_blank">
                    <span class="hidden-desktop">Twitter</span>
                  </a>
                </li>
                
                
                
                
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="content">
          
<div class="page-header">
  <h1>
    masseuse routers 
    
  </h1>
</div>

<div class="row">
  <div class="span8">
    <p>Absolute Basic Router:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">masseuse</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">excludeFromBeforeRouting</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;thisrouteis/excluded/:id&#39;</span><span class="p">],</span>
    <span class="nx">routes</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;thisrouteis/excluded/:id&#39;</span> <span class="o">:</span> <span class="s1">&#39;excluded&#39;</span>
        <span class="s1">&#39;*catchall&#39;</span> <span class="o">:</span> <span class="s1">&#39;someMethodThatCalledLoadMainContent&#39;</span>
    <span class="p">},</span>
    <span class="nx">beforeRouting</span> <span class="o">:</span> <span class="nx">beforeRouting</span><span class="p">,</span>
    <span class="nx">onRouteFail</span> <span class="o">:</span> <span class="nx">onRouteFail</span><span class="p">,</span>
    <span class="nx">loadMainContent</span> <span class="o">:</span> <span class="nx">loadMainContent</span>

<span class="p">});</span>
</code></pre></div>
<hr>

<h2>excludeFromBeforeRouting</h2>

<p>This is an array of routes that when hit, will not trigger <code>beforeRouting</code>.</p>

<p>For example:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">excludeFromBeforeRouting</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="s1">&#39;thisrouteis/excluded/:id&#39;</span><span class="p">],</span>
</code></pre></div>
<hr>

<h2>routes</h2>

<p>Make sure to reference the methods via strings and not via function reference if you want <code>onBeforeRouting</code> to work.
Routes in one router should be conceptually grouped.
If routes starts to get too big, create multiple routers.</p>

<p><a href="http://backbonejs.org/#Router-routes">See backbone docs</a>
The &#39;catchall&#39; should contain at least one character after the star(and should be the last route in the routes obj).</p>

<hr>

<h2>beforeRouting</h2>

<p>Is a noop, if you define it, you must return a promise.
The promise that is returned, determines if you can pass, or if you shall not pass.</p>

<p>This is useful for things like auth.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">beforeRouting</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$deferred</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">()</span>

    <span class="c1">// If the deferred is resolved, then you can rage on.</span>
    <span class="c1">// If the deferred is rejected, then onRouteFail will be called.</span>

    <span class="k">return</span> <span class="nx">$deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>onRouteFail</h2>

<p>This method is called if the beforeRouting deferred is rejected.<br>
It is useful for logging people out, displaying an error page, etc. </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">onRouteFail</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// this guy will be called when you reject beforeRouting deferred.</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>Modularization</h2>

<p><a href="todo:create%20massesuse%20examples%20example">Example</a></p>

<p>To create multiple routers:</p>

<ol>
<li><p>Create a base router.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">BaseRouter</span> <span class="o">=</span> <span class="nx">masseuse</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="c1">// Shared methods</span>
    <span class="nx">loadMainContent</span><span class="o">:</span> <span class="nx">loadMainContent</span><span class="p">,</span>
    <span class="nx">beforeRouting</span><span class="o">:</span> <span class="nx">beforeRouting</span><span class="p">,</span>
    <span class="nx">onRouteFail</span><span class="o">:</span> <span class="nx">onRouteFail</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p>Create individual routers that extend the base router.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">LoginRouter</span> <span class="o">=</span> <span class="nx">BaseRouter</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="c1">// Specific to this group of routes</span>
    <span class="nx">excludeFromBeforeRouting</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="s1">&#39;register&#39;</span><span class="p">],</span>
    <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;login&#39;</span><span class="o">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
        <span class="s1">&#39;logout&#39;</span><span class="o">:</span> <span class="s1">&#39;logout&#39;</span><span class="p">,</span>
        <span class="s1">&#39;register&#39;</span><span class="o">:</span> <span class="s1">&#39;register&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">AdminRouter</span> <span class="o">=</span> <span class="nx">BaseRouter</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p>Start up each individual router in the same place you would start your one router.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">new</span> <span class="nx">LoginRouter</span><span class="p">();</span>
<span class="k">new</span> <span class="nx">AdminRouter</span><span class="p">();</span>

<span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</code></pre></div></li>
</ol>

<hr>

<h2>loadMainContent</h2>

<p>Loads a parent view into a DOM element and removes anything currently in that DOM element. Similar to changing a page
on a server side app.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">loadMainContent</span> <span class="p">(</span><span class="nx">ViewType</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$deferred</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">(),</span>
        <span class="nx">newView</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">modelData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">modelData</span><span class="p">.</span><span class="nx">resources</span> <span class="o">=</span> <span class="nx">resources</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">newView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewType</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">currentView</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currentView</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">newView</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">currentView</span> <span class="o">=</span> <span class="nx">newView</span><span class="p">;</span>
            <span class="nx">$deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">newView</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">$deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
        <span class="p">});</span>

    <span class="k">return</span> <span class="nx">$deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>Push State</h2>

<p>On a server all routes should be redirected to render the same html index page:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Express router example</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;/example(/*)?&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">showStaticPage</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="s1">&#39;example&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>Then push state has to be turned on for Backbone:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
    <span class="nx">hashChange</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">pushState</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>
</code></pre></div>
<p>Then <a href="http://stackoverflow.com/questions/9328513/backbone-js-and-pushstate">clicks on <code>a</code> tags have to be intercepted</a> 
so as not to reload the page. </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">setupPushState</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;a[href^=&quot;/&lt;%= someBaseUrl %&gt;&quot;]&#39;</span><span class="p">,</span> <span class="nx">navigate</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>You might also want to make a navigate method that will ignore certain keys so that a lot of people can command click on stuff. 
Sometimes, in the fall, a person might find themselves not wanting to actually navigate, only open that page up.
It behooves oneself to enable this kind of navigation. If one was willing to command click on something, one would expect this particular behavior. </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">navigate</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$a</span><span class="p">,</span>
        <span class="nx">url</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">altKey</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$a</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$a</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="nx">url</span> <span class="o">=</span> <span class="nx">$a</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\//</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="nx">trigger</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<p>create and link to working example</p>

    <hr>
    <div class="pagination btn-group">
      
        <a class="btn prev" href="http://solid-interactive.github.io/Recipes/masseuse-plugins" title="masseuse plugins">&larr; Previous</a>
      
        <a class="btn" href="http://solid-interactive.github.io/Recipes/archive.html">Archive</a>
      
        <a class="btn next" href="http://solid-interactive.github.io/Recipes/grasshopper-admin-dev-workflow" title="Grasshopper Admin Dev Workflow">Next &rarr;</a>
      
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <section>
      <h4>Published</h4>
      <div class="date"><span>17 July 2014</span></div>
    </section>
    
      <section>
        <h4>Category</h4>
        <span class="category">
          examples
        </span>
      </section>
         
    
      <section>
        <h4>Tags</h4>
        <ul class="tag_box">
          
          


  
     
    	<li><a href="http://solid-interactive.github.io/Recipes/tags.html#masseuse-ref">masseuse <span>3</span></a></li>
     
    	<li><a href="http://solid-interactive.github.io/Recipes/tags.html#routers-ref">routers <span>1</span></a></li>
    
  



        </ul>
      </section>
             
  </div>
</div>


        </div>
      </div> <!-- /container -->

      <div class="footer-push"></div>
    </div><!--/.page-wrap -->

    <footer>
      <div class="container">
        <p>&copy; 2014 Solid Interactive
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://github.com/dhulihan/hooligan" target="_blank">The Hooligan Theme</a>
        </p>
      </div>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/js/jquery.min.js"><\/script>')</script>
    <script src="http://solid-interactive.github.io/Recipes/assets/themes/hooligan/bootstrap/js/bootstrap.min.js"></script>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-123-12']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

